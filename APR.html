
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Past Papers Archive - Actiari Study Tools</title>
<meta name="description" content="Searchable archive of A-Level and BTEC past papers for AQA, Edexcel, and OCR. Find and download exam papers and mark schemes.">
<meta name="keywords" content="A Level, BTEC, Past Papers, AQA, Edexcel, OCR, Revision, Study Tools, Actiari">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
/* ------------------- */
/* --- CSS Reset & Variables --- */
/* ------------------- */
:root {
--font-family-sans: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
--font-weight-regular: 400;
--font-weight-medium: 500;
--font-weight-semibold: 600;
--font-weight-bold: 700;
--radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 16px;

        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);

        /* Light Theme */
        --color-background: #f8f9fa;
        --color-surface: #ffffff;
        --color-surface-hover: #f1f3f5;
        --color-border: #dee2e6;
        --color-text-primary: #212529;
        --color-text-secondary: #495057;
        --color-text-muted: #868e96;
        --color-primary: #005fcc;
        --color-primary-hover: #004ca3;
        --color-accent: #0ca678;
        --color-accent-hover: #087f5b;
        --color-accent-text: #ffffff;
    }

    .dark-mode {
        --color-background: #121212;
        --color-surface: #1e1e1e;
        --color-surface-hover: #2c2c2c;
        --color-border: #333;
        --color-text-primary: #e0e0e0;
        --color-text-secondary: #b0b0b0;
        --color-text-muted: #757575;
        --color-primary: #4dabf7;
        --color-primary-hover: #74c0fc;
        --color-accent: #20c997;
        --color-accent-hover: #48d8ab;
        --color-accent-text: #121212;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body {
        font-family: var(--font-family-sans);
        background-color: var(--color-background);
        color: var(--color-text-primary);
        line-height: 1.6;
        font-size: 16px;
        transition: background-color 0.2s, color 0.2s;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
    }
    main { flex-grow: 1; }
    a { color: var(--color-primary); text-decoration: none; }
    a:hover { text-decoration: underline; }
    img, svg { max-width: 100%; display: block; }
    input, button, select { font: inherit; }
    :focus-visible { outline: 2px solid var(--color-primary); outline-offset: 2px; border-radius: var(--radius-sm); }
    .visually-hidden {
        position: absolute; width: 1px; height: 1px;
        padding: 0; margin: -1px; overflow: hidden;
        clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0;
    }

    /* ------------------- */
    /* --- Layout & Components --- */
    /* ------------------- */
    .page-wrapper { max-width: 1400px; margin: 0 auto; padding: 0 24px; width: 100%; }
    
    /* --- Header --- */
    .site-header {
        padding: 16px 0;
        background-color: var(--color-surface);
        border-bottom: 1px solid var(--color-border);
        box-shadow: var(--shadow-sm);
        position: sticky;
        top: 0;
        z-index: 1000;
    }
    .site-header .page-wrapper { display: flex; justify-content: space-between; align-items: center; }
    .site-header__nav ul { list-style: none; display: flex; gap: 24px; }
    .site-header__nav a { color: var(--color-text-secondary); font-weight: var(--font-weight-medium); transition: color 0.2s; }
    .site-header__nav a:hover, .site-header__nav a[aria-current="page"] { color: var(--color-primary); }
    .theme-toggle {
        background: none; border: none; cursor: pointer; color: var(--color-text-secondary);
        padding: 8px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
        transition: background-color 0.2s, color 0.2s;
    }
    .theme-toggle:hover { background-color: var(--color-surface-hover); color: var(--color-text-primary); }
    .theme-toggle svg { width: 20px; height: 20px; }
    .theme-toggle .icon-sun { display: none; }
    .dark-mode .theme-toggle .icon-sun { display: block; }
    .dark-mode .theme-toggle .icon-moon { display: none; }

    /* --- Page Title --- */
    .page-title { text-align: center; margin: 48px 0; }
    .page-title h1 { font-size: 2.5rem; font-weight: var(--font-weight-bold); color: var(--color-text-primary); }
    .page-title p { font-size: 1.125rem; color: var(--color-text-secondary); margin-top: 8px; max-width: 60ch; margin-left: auto; margin-right: auto; }

    /* --- Controls & Filters --- */
    .controls-container {
        background-color: var(--color-surface);
        border-radius: var(--radius-md);
        padding: 24px;
        margin-bottom: 32px;
        box-shadow: var(--shadow-md);
        border: 1px solid var(--color-border);
    }
    .filters { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
    .filter-group { display: flex; flex-direction: column; }
    .filter-group label { font-weight: var(--font-weight-medium); color: var(--color-text-secondary); margin-bottom: 8px; font-size: 0.9rem; }
    .filter-group select, .filter-group input {
        width: 100%; padding: 10px 12px;
        border: 1px solid var(--color-border);
        border-radius: var(--radius-md);
        background-color: var(--color-background);
        color: var(--color-text-primary);
        transition: border-color 0.2s, box-shadow 0.2s;
    }
    .filter-group select:focus, .filter-group input:focus { border-color: var(--color-primary); box-shadow: 0 0 0 2px color-mix(in srgb, var(--color-primary) 25%, transparent); }
    .controls-actions { display: flex; gap: 16px; margin-top: 24px; flex-wrap: wrap; }
    .clear-filters-btn {
        padding: 10px 20px; background-color: transparent;
        border: 1px solid var(--color-border); color: var(--color-text-secondary);
        border-radius: var(--radius-md); cursor: pointer; font-weight: var(--font-weight-medium);
        transition: all 0.2s;
    }
    .clear-filters-btn:hover { background-color: var(--color-surface-hover); border-color: var(--color-text-muted); color: var(--color-text-primary); }

    .active-filters { margin-top: 20px; display: flex; flex-wrap: wrap; gap: 8px; }
    .filter-chip {
        display: inline-flex; align-items: center; gap: 6px;
        background-color: color-mix(in srgb, var(--color-primary) 15%, transparent);
        color: var(--color-primary);
        padding: 4px 10px;
        border-radius: var(--radius-lg);
        font-size: 0.875rem;
        font-weight: var(--font-weight-medium);
    }
    .filter-chip button {
        background: none; border: none; cursor: pointer; color: inherit;
        padding: 2px; margin: -2px; display: flex; align-items: center;
        border-radius: 50%;
    }
    .filter-chip button:hover { background-color: color-mix(in srgb, var(--color-primary) 20%, transparent); }
    .filter-chip svg { width: 14px; height: 14px; }
    
    .results-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 16px; }
    #results-count { color: var(--color-text-secondary); font-weight: var(--font-weight-medium); }
    .sort-view-controls { display: flex; align-items: center; gap: 16px; }
    .sort-view-controls select {
         padding: 8px 12px;
         border: 1px solid var(--color-border); border-radius: var(--radius-md);
         background-color: var(--color-surface); color: var(--color-text-primary);
    }
    
    /* --- Results Grid & Cards --- */
    #results-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 24px;
    }
    .paper-card {
        background-color: var(--color-surface);
        border-radius: var(--radius-md);
        border: 1px solid var(--color-border);
        box-shadow: var(--shadow-sm);
        padding: 24px;
        display: flex;
        flex-direction: column;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .paper-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-md); }
    .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; }
    .card-header__info h2 { font-size: 1.125rem; font-weight: var(--font-weight-semibold); margin-bottom: 4px; }
    .card-header__info p { color: var(--color-text-secondary); font-size: 0.9rem; }
    .card-year {
        font-size: 1.75rem;
        font-weight: var(--font-weight-bold);
        color: var(--color-primary);
        line-height: 1;
    }
    .card-body p { margin-bottom: 20px; font-size: 1rem; color: var(--color-text-primary); }
    .card-footer { margin-top: auto; display: flex; flex-direction: column; gap: 12px; }
    .card-link {
        display: flex; align-items: center; justify-content: center; gap: 8px;
        padding: 12px; border-radius: var(--radius-md);
        font-weight: var(--font-weight-medium);
        text-align: center;
        transition: background-color 0.2s, color 0.2s;
    }
    .card-link svg { width: 18px; height: 18px; }
    .card-link--paper { background-color: var(--color-accent); color: var(--color-accent-text); }
    .card-link--paper:hover { background-color: var(--color-accent-hover); text-decoration: none; }
    .card-link--ms { border: 1px solid var(--color-accent); color: var(--color-accent); }
    .card-link--ms:hover { background-color: color-mix(in srgb, var(--color-accent) 10%, transparent); text-decoration: none; }
    .card-link--disabled {
        background-color: var(--color-surface-hover);
        color: var(--color-text-muted);
        border: 1px solid var(--color-border);
        cursor: not-allowed;
        pointer-events: none;
    }
    .card-link--disabled:hover { background-color: var(--color-surface-hover); }

    /* --- No Results Message --- */
    .no-results {
        grid-column: 1 / -1;
        text-align: center;
        padding: 64px 24px;
        background-color: var(--color-surface);
        border-radius: var(--radius-md);
        border: 1px solid var(--color-border);
    }
    .no-results h3 { font-size: 1.5rem; margin-bottom: 8px; }
    .no-results p { color: var(--color-text-secondary); }

    /* --- Footer --- */
    .site-footer {
        margin-top: 64px;
        padding: 32px 0;
        background-color: var(--color-surface);
        border-top: 1px solid var(--color-border);
        text-align: center;
        color: var(--color-text-secondary);
        font-size: 0.9rem;
    }
    .site-footer .page-wrapper { display: flex; flex-direction: column; gap: 8px; }
    .site-footer a { color: var(--color-text-primary); font-weight: var(--font-weight-medium); }

    /* ------------------- */
    /* --- Responsive Design --- */
    /* ------------------- */
    @media (max-width: 768px) {
        .page-wrapper { padding: 0 16px; }
        .page-title { margin: 32px 0; }
        .page-title h1 { font-size: 2rem; }
        .filters { grid-template-columns: 1fr; }
        .results-header { flex-direction: column; align-items: stretch; }
        #results-container { grid-template-columns: 1fr; }
        .site-header__nav { display: none; /* Simplified for this example, would use JS toggle for real app */ }
    }
</style>
</head>
<body>
    <header class="site-header">
    <div class="page-wrapper">
        <a href="index.html" class="site-header__logo" aria-label="Actiari Home">
            <svg width="120" height="28" viewBox="0 0 120 28" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M6.023 21.28V7.51h3.192v11.16c0 1.512.864 2.52 2.376 2.52s2.376-1.008 2.376-2.52V7.51h3.192v11.16c0 3.312-2.16 5.328-5.568 5.328s-5.568-2.016-5.568-5.328zM24.79 26.608h3.216V7.51h-3.216v19.098zM36.166 7.51l-4.248 12.096h-.072L27.646 7.51h-3.336l5.76 15.624L24.37 7.51h-3.216v19.098h3.048v-3.792l.864 2.592c.648 1.944 2.232 3.192 4.32 3.192 2.616 0 4.608-1.728 4.608-4.56v-3.336l-3.048-8.208 4.536-10.608h-2.736zM34.822 17.04l2.088 5.88c0 .288.12.432.336.432.216 0 .336-.144.336-.432v-5.232l-2.76-6.432-2.112 5.784zM53.155 22.048c-3.12 0-5.112-2.016-5.112-5.04 0-3.024 1.992-5.064 5.112-5.064 3.096 0 5.088 2.04 5.088 5.064 0 3.024-1.992 5.04-5.088 5.04zm0-2.616c1.392 0 2.088-.936 2.088-2.424 0-1.488-.696-2.448-2.088-2.448s-2.088.96-2.088 2.448c0 1.488.696 2.424 2.088 2.424zM69.042 26.608h3.216V7.51h-3.216v19.098zM79.506 22.048c-3.12 0-5.112-2.016-5.112-5.04 0-3.024 1.992-5.064 5.112-5.064 3.096 0 5.088 2.04 5.088 5.064 0 3.024-1.992 5.04-5.088 5.04zm0-2.616c1.392 0 2.088-.936 2.088-2.424 0-1.488-.696-2.448-2.088-2.448s-2.088.96-2.088 2.448c0 1.488.696 2.424 2.088 2.424zM95.634 12.04c0-2.88-1.872-4.896-4.968-4.896s-4.968 2.016-4.968 4.896v9.96c0 2.88 1.872 4.896 4.968 4.896s4.968-2.016 4.968-4.896v-9.96zm-3.048 9.96c0 1.488-.672 2.424-1.92 2.424s-1.92-.936-1.92-2.424v-9.96c0-1.488.672-2.424 1.92-2.424s1.92.936 1.92 2.424v9.96zM107.13 22.048c-3.12 0-5.112-2.016-5.112-5.04 0-3.024 1.992-5.064 5.112-5.064 3.096 0 5.088 2.04 5.088 5.064 0 3.024-1.992 5.04-5.088 5.04zm0-2.616c1.392 0 2.088-.936 2.088-2.424 0-1.488-.696-2.448-2.088-2.448-2.088 0-2.088.96-2.088 2.448 0 1.488.696 2.424 2.088 2.424zM119.537 7.51h-3.048l-2.016 7.464-2.016-7.464h-3.048v19.098h3.048V13.84l2.016 7.536h.048l2.016-7.536v12.768h3.048V7.51z"/></svg>
        </a>
        <nav class="site-header__nav">
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="APR.html" aria-current="page">A Level & BTEC Past Papers</a></li>
            </ul>
        </nav>
        <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
            <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
        </button>
    </div>
</header>

<main class="page-wrapper">
    <div class="page-title">
        <h1>Past Papers Archive</h1>
        <p>Filter by exam board, qualification, subject, and year to find the revision materials you need.</p>
    </div>

    <section class="controls-container" aria-labelledby="controls-heading">
        <h2 id="controls-heading" class="visually-hidden">Filter and Sort Controls</h2>
        <div class="filters">
            <div class="filter-group">
                <label for="filter-exam-board">Exam Board</label>
                <select id="filter-exam-board">
                    <option value="all">All Boards</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-qualification">Qualification</label>
                <select id="filter-qualification">
                    <option value="all">All Qualifications</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-subject">Subject</label>
                <select id="filter-subject">
                    <option value="all">All Subjects</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-year">Year</label>
                <select id="filter-year">
                    <option value="all">All Years</option>
                </select>
            </div>
        </div>
        <div id="active-filters-container" class="active-filters"></div>
        <div class="controls-actions">
            <button id="clear-filters-btn" class="clear-filters-btn">Clear All Filters</button>
        </div>
    </section>

    <section aria-labelledby="results-heading">
        <div class="results-header">
            <h2 id="results-heading" class="visually-hidden">Exam Paper Results</h2>
            <div id="results-count"></div>
            <div class="sort-view-controls">
                 <label for="sort-by" class="visually-hidden">Sort by</label>
                <select id="sort-by">
                    <option value="year_desc">Year (Newest First)</option>
                    <option value="year_asc">Year (Oldest First)</option>
                    <option value="subject_asc">Subject (A-Z)</option>
                    <option value="subject_desc">Subject (Z-A)</option>
                </select>
            </div>
        </div>
        <div id="results-container">
            <!-- Paper cards will be dynamically inserted here -->
        </div>
    </section>

</main>

<footer class="site-footer">
    <div class="page-wrapper">
        <p>&copy; 2025 Actiari Study Tools. All rights reserved.</p>
        <p>Last updated: October 2023 | <a href="https://github.com/actiari">GitHub</a></p>
    </div>
</footer>

<script>
(function() {
    'use strict';

    // ------------------- */
    // --- DATA SOURCE --- */
    // ------------------- */
    // INSTRUCTIONS: To add more papers, add a new object to the `pastPapersData` array below.
    // - `id`: A unique number for each entry.
    // - `examBoard`: 'AQA', 'Edexcel', 'OCR A', etc.
    // - `qualification`: 'A-Level', 'AS-Level', 'BTEC'.
    // - `subject`: The name of the subject, e.g., 'Geography', 'Mathematics'.
    // - `year`: The numerical year of the exam.
    // - `session`: A descriptive string like 'June 2022' or 'October 2021'.
    // - `paperTitle`: The specific title of the paper, e.g., 'Paper 1: Physical Geography'.
    // - `paperUrl`: The relative or absolute URL to the question paper PDF.
    // - `markSchemeUrl`: URL to the mark scheme. Use null if not available.
    // - `insertUrl`: URL to any insert/resource booklet. Use null if not applicable.
    //
    // NOTE: This is a sample dataset based on the structure of the original APR.html file.
    // The original file dynamically loaded data from external CSVs, which are not available here.
    // This sample demonstrates full functionality with a representative data subset.
    const pastPapersData = [
        { id: 1, examBoard: 'AQA', qualification: 'A-Level', subject: 'Geography', year: 2022, session: 'June 2022', paperTitle: 'Paper 1: Physical Geography', paperUrl: './path/to/paper.pdf', markSchemeUrl: './path/to/ms.pdf', insertUrl: './path/to/insert.pdf' },
        { id: 2, examBoard: 'AQA', qualification: 'A-Level', subject: 'Geography', year: 2022, session: 'June 2022', paperTitle: 'Paper 2: Human Geography', paperUrl: './path/to/paper.pdf', markSchemeUrl: './path/to/ms.pdf', insertUrl: './path/to/insert.pdf' },
        { id: 3, examBoard: 'AQA', qualification: 'A-Level', subject: 'Geography', year: 2021, session: 'November 2021', paperTitle: 'Paper 1: Physical Geography', paperUrl: './path/to/paper.pdf', markSchemeUrl: './path/to/ms.pdf', insertUrl: null },
        { id: 4, examBoard: 'AQA', qualification: 'AS-Level', subject: 'Mathematics', year: 2022, session: 'June 2022', paperTitle: 'Paper 1', paperUrl: './path/to/paper.pdf', markSchemeUrl: './path/to/ms.pdf', insertUrl: null },
        { id: 5, examBoard: 'AQA', qualification: 'AS-Level', subject: 'Mathematics', year: 2022, session: 'June 2022', paperTitle: 'Paper 2', paperUrl: './path/to/paper.pdf', markSchemeUrl: './path/to/ms.pdf', insertUrl: null },
        { id: 6, examBoard: 'Edexcel', qualification: 'BTEC', subject: 'Applied Science', year: 2021, session: 'January 2021', paperTitle: 'Unit 1B: Biology', paperUrl: './path/to/paper.pdf', markSchemeUrl: './path/to/ms.pdf', insertUrl: null },
        { id: 7, examBoard: 'Edexcel', qualification: 'BTEC', subject: 'Applied Science', year: 2021, session: 'January 2021', paperTitle: 'Unit 1C: Chemistry', paperUrl: './path/to/paper.pdf', markSchemeUrl: null, insertUrl: null },
        { id: 8, examBoard: 'Edexcel', qualification: 'BTEC', subject: 'Information Technology', year: 2022, session: 'June 2022', paperTitle: 'Unit 1: Information Technology Systems', paperUrl: './path/to/paper.pdf', markSchemeUrl: './path/to/ms.pdf', insertUrl: null },
        { id: 9, examBoard: 'OCR A', qualification: 'A-Level', subject: 'Chemistry', year: 2022, session: 'June 2022', paperTitle: 'H432/01: Periodic table, elements and physical chemistry', paperUrl: './path/to/paper.pdf', markSchemeUrl: './path/to/ms.pdf', insertUrl: null },
        { id: 10, examBoard: 'OCR A', qualification: 'A-Level', subject: 'Chemistry', year: 2022, session: 'June 2022', paperTitle: 'H432/02: Synthesis and analytical techniques', paperUrl: './path/to/paper.pdf', markSchemeUrl: './path/to/ms.pdf', insertUrl: null },
        { id: 11, examBoard: 'OCR A', qualification: 'AS-Level', subject: 'Physics', year: 2021, session: 'June 2021', paperTitle: 'H156/01: Breadth in physics', paperUrl: './path/to/paper.pdf', markSchemeUrl: './path/to/ms.pdf', insertUrl: null },
        { id: 12, examBoard: 'OCR A', qualification: 'A-Level', subject: 'Physics', year: 2023, session: 'June 2023', paperTitle: 'H556/01: Modelling physics', paperUrl: './path/to/paper.pdf', markSchemeUrl: './path/to/ms.pdf', insertUrl: null },
    ];
    
    // --- DOM Elements ---
    const themeToggleButton = document.getElementById('theme-toggle');
    const resultsContainer = document.getElementById('results-container');
    const resultsCountEl = document.getElementById('results-count');
    const filterBoardEl = document.getElementById('filter-exam-board');
    const filterQualEl = document.getElementById('filter-qualification');
    const filterSubjectEl = document.getElementById('filter-subject');
    const filterYearEl = document.getElementById('filter-year');
    const sortByEl = document.getElementById('sort-by');
    const clearFiltersBtn = document.getElementById('clear-filters-btn');
    const activeFiltersContainer = document.getElementById('active-filters-container');

    // --- State Management ---
    let state = {
        filters: {
            examBoard: 'all',
            qualification: 'all',
            subject: 'all',
            year: 'all'
        },
        sortBy: 'year_desc'
    };

    // --- Functions ---
    
    // Theme Toggle
    function applyTheme(theme) {
        if (theme === 'dark') {
            document.documentElement.classList.add('dark-mode');
        } else {
            document.documentElement.classList.remove('dark-mode');
        }
    }
    function toggleTheme() {
        const currentTheme = document.documentElement.classList.contains('dark-mode') ? 'light' : 'dark';
        localStorage.setItem('theme', currentTheme);
        applyTheme(currentTheme);
    }

    // Populate Filter Dropdowns
    function populateFilters() {
        const getUniqueValues = (key) => [...new Set(pastPapersData.map(item => item[key]))].sort();
        
        const boards = getUniqueValues('examBoard');
        const qualifications = getUniqueValues('qualification');
        const subjects = getUniqueValues('subject');
        const years = getUniqueValues('year').sort((a, b) => b - a); // Sort years descending

        const populate = (el, values) => {
            values.forEach(value => {
                const option = document.createElement('option');
                option.value = value;
                option.textContent = value;
                el.appendChild(option);
            });
        };

        populate(filterBoardEl, boards);
        populate(filterQualEl, qualifications);
        populate(filterSubjectEl, subjects);
        populate(filterYearEl, years);
    }
    
    // Render Functions
    function renderResults() {
        // 1. Filter data
        let filteredData = [...pastPapersData];
        Object.entries(state.filters).forEach(([key, value]) => {
            if (value !== 'all') {
                filteredData = filteredData.filter(item => String(item[key]) === String(value));
            }
        });

        // 2. Sort data
        const [sortKey, sortDir] = state.sortBy.split('_');
        filteredData.sort((a, b) => {
            const valA = a[sortKey];
            const valB = b[sortKey];
            
            if (valA < valB) return sortDir === 'asc' ? -1 : 1;
            if (valA > valB) return sortDir === 'asc' ? 1 : -1;
            return 0;
        });
        
        // 3. Update results count
        resultsCountEl.textContent = `Showing ${filteredData.length} of ${pastPapersData.length} results`;

        // 4. Render HTML
        resultsContainer.innerHTML = ''; // Clear previous results
        if (filteredData.length === 0) {
            resultsContainer.innerHTML = `
                <div class="no-results">
                    <h3>No Papers Found</h3>
                    <p>Try adjusting your filters or click "Clear All Filters" to start over.</p>
                </div>
            `;
            return;
        }

        const fragment = document.createDocumentFragment();
        filteredData.forEach(paper => {
            const card = document.createElement('article');
            card.className = 'paper-card';
            card.innerHTML = `
                <div class="card-header">
                    <div class="card-header__info">
                        <h2>${paper.subject}</h2>
                        <p>${paper.qualification} &bull; ${paper.examBoard}</p>
                    </div>
                    <div class="card-year">${paper.year}</div>
                </div>
                <div class="card-body">
                    <p>${paper.paperTitle}</p>
                </div>
                <footer class="card-footer">
                    <a href="${paper.paperUrl}" class="card-link card-link--paper" target="_blank" rel="noopener noreferrer">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                        <span>Question Paper</span>
                    </a>
                    ${paper.markSchemeUrl 
                        ? `<a href="${paper.markSchemeUrl}" class="card-link card-link--ms" target="_blank" rel="noopener noreferrer">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><polyline points="9 15 11 17 15 13"></polyline></svg>
                            <span>Mark Scheme</span>
                           </a>` 
                        : `<div class="card-link card-link--disabled">
                            <span>Mark Scheme Not Available</span>
                           </div>`
                    }
                </footer>
            `;
            fragment.appendChild(card);
        });
        resultsContainer.appendChild(fragment);
    }

    function renderActiveFilters() {
        activeFiltersContainer.innerHTML = '';
        Object.entries(state.filters).forEach(([key, value]) => {
            if (value !== 'all') {
                const chip = document.createElement('div');
                chip.className = 'filter-chip';
                const label = document.querySelector(`label[for="filter-${key.replace(/([A-Z])/g, '-$1').toLowerCase()}"]`).textContent;
                chip.innerHTML = `
                    <span>${label}: ${value}</span>
                    <button data-filter-key="${key}" aria-label="Remove ${label} filter">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                `;
                activeFiltersContainer.appendChild(chip);
            }
        });
    }

    // URL Handling
    function updateURL() {
        const params = new URLSearchParams();
        Object.entries(state.filters).forEach(([key, value]) => {
            if (value !== 'all') {
                params.set(key, value);
            }
        });
        params.set('sortBy', state.sortBy);
        const newUrl = `${window.location.pathname}?${params.toString()}`;
        window.history.pushState({}, '', newUrl);
    }

    function loadStateFromURL() {
        const params = new URLSearchParams(window.location.search);
        const newState = {
            filters: {
                examBoard: params.get('examBoard') || 'all',
                qualification: params.get('qualification') || 'all',
                subject: params.get('subject') || 'all',
                year: params.get('year') || 'all'
            },
            sortBy: params.get('sortBy') || 'year_desc'
        };
        state = newState;
        
        // Update UI controls to match state
        filterBoardEl.value = state.filters.examBoard;
        filterQualEl.value = state.filters.qualification;
        filterSubjectEl.value = state.filters.subject;
        filterYearEl.value = state.filters.year;
        sortByEl.value = state.sortBy;
    }

    // Event Handlers
    function handleFilterChange() {
        state.filters.examBoard = filterBoardEl.value;
        state.filters.qualification = filterQualEl.value;
        state.filters.subject = filterSubjectEl.value;
        state.filters.year = filterYearEl.value;
        renderAll();
    }

    function handleSortChange() {
        state.sortBy = sortByEl.value;
        renderAll();
    }

    function handleClearFilters() {
        state.filters = { examBoard: 'all', qualification: 'all', subject: 'all', year: 'all' };
        // Reset UI
        filterBoardEl.value = 'all';
        filterQualEl.value = 'all';
        filterSubjectEl.value = 'all';
        filterYearEl.value = 'all';
        renderAll();
    }

    function handleRemoveChip(e) {
        const button = e.target.closest('button');
        if (button) {
            const key = button.dataset.filterKey;
            state.filters[key] = 'all';
            document.getElementById(`filter-${key.replace(/([A-Z])/g, '-$1').toLowerCase()}`).value = 'all';
            renderAll();
        }
    }

    // Master render function
    function renderAll() {
        renderResults();
        renderActiveFilters();
        updateURL();
    }

    // Initialization
    function init() {
        // Theme setup
        const savedTheme = localStorage.getItem('theme') || 'light';
        applyTheme(savedTheme);
        themeToggleButton.addEventListener('click', toggleTheme);

        // Populate filters and load state
        populateFilters();
        loadStateFromURL();

        // Initial render
        renderAll();

        // Attach event listeners
        filterBoardEl.addEventListener('change', handleFilterChange);
        filterQualEl.addEventListener('change', handleFilterChange);
        filterSubjectEl.addEventListener('change', handleFilterChange);
        filterYearEl.addEventListener('change', handleFilterChange);
        sortByEl.addEventListener('change', handleSortChange);
        clearFiltersBtn.addEventListener('click', handleClearFilters);
        activeFiltersContainer.addEventListener('click', handleRemoveChip);

        // Handle browser back/forward buttons
        window.addEventListener('popstate', () => {
            loadStateFromURL();
            renderAll();
        });
    }

    // Run on page load
    document.addEventListener('DOMContentLoaded', init);

})();
</script>
</body>
</html>