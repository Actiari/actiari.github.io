<!doctype html>
<html>
<head>
    <link rel='icon' type='image/x-icon' href='./Miscellaneous/Main Favicon.ico'>
    <style>
        :root {
            /* Default colors - will be overridden by JS */
            --primary-color: #1e7dba;
            --secondary-color: #e9f2f9;
            --dark-grey: #333333;
            --light-grey: #f5f7fa;
            --border-color: #d1d9e6;
        }
        
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-grey);
            color: #444;
            line-height: 1.6;
        }
        
        /* Navigation styles */
        .nav-container {
            background-color: #333;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0;
            position: relative;
            height: 60px; /* Fixed height to match other pages */
        }
        
        .logo {
            display: flex;
            align-items: center;
            text-decoration: none;
            padding: 0 20px;
            height: 100%;
        }
        
        .logo img {
            width: 42px;
            height: 38px;
            vertical-align: middle;
        }
        
        .nav-menu {
            list-style-type: none;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            margin: 0;
            padding: 0;
            height: 100%;
        }
        
        .nav-menu li {
            height: 100%;
            display: flex;
            align-items: center;
        }
        
        .nav-menu li a {
            display: flex;
            align-items: center;
            height: 100%;
            color: white;
            text-align: center;
            padding: 0 16px;
            text-decoration: none;
            white-space: nowrap;
            transition: background-color 0.2s;
        }
        
        .nav-menu li a:hover {
            background-color: #444;
        }
        
        .menu-toggle {
            display: none;
            color: white;
            background: none;
            border: none;
            font-size: 24px;
            padding: 12px 16px;
            cursor: pointer;
            margin-left: auto;
        }
        
        /* Selector Controls */
        .selector-controls {
            background-color: white;
            padding: 20px;
            margin: 20px auto;
            max-width: 1000px;
            border-radius: 6px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
            border: 1px solid var(--border-color);
        }
        
        .selector-group {
            flex: 1;
            min-width: 200px;
        }
        
        .selector-label {
            font-weight: 600;
            margin-bottom: 8px;
            display: block;
            color: var(--dark-grey);
        }
        
        .custom-select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 16px;
            background-color: white;
            cursor: pointer;
        }
        
        /* Page title */
        .page-header {
            background-color: var(--primary-color);
            color: white;
            padding: 24px 0;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .page-header h1 {
            margin: 0;
            padding: 0;
            font-size: 2.2rem;
            font-weight: 600;
        }
        
        .page-header h2 {
            margin: 5px 0 0 0;
            padding: 0;
            font-size: 1.4rem;
            font-weight: 400;
            opacity: 0.9;
        }
        
        /* Resources section */
        .resources-section {
            max-width: 1000px;
            margin: 0 auto 20px auto;
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            border: 1px solid var(--border-color);
        }
        
        .resources-header {
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 15px;
            color: var(--primary-color);
            font-size: 1.4rem;
            font-weight: 600;
        }
        
        .resources-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .resources-table td {
            padding: 8px 10px;
            text-align: left;
            border: none;
        }
        
        /* Level tabs */
        .level-tabs {
            max-width: 1000px;
            margin: 0 auto 10px auto;
            display: flex;
            gap: 10px;
        }
        
        .level-tab {
            padding: 10px 20px;
            background-color: #ddd;
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            font-weight: 500;
            border: 1px solid var(--border-color);
            border-bottom: none;
        }
        
        .level-tab.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        /* Main table */
        .papers-container {
            max-width: 1000px;
            margin: 0 auto 30px auto;
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            border: 1px solid var(--border-color);
        }
        
        .papers-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
        }
        
        .papers-table th, .papers-table td {
            padding: 14px 12px;
            text-align: center;
            border: 1px solid var(--border-color);
        }
        
        .papers-table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
            font-size: 1rem;
        }
        
        .papers-table tr:nth-child(even) {
            background-color: var(--secondary-color);
        }
        
        .series-column {
            font-weight: 600;
            background-color: #f0f6fc;
        }
        
        .download-link {
            display: inline-block;
            padding: 8px 16px;
            background-color: var(--primary-color);
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }
        
        .download-link:hover {
            background-color: rgba(var(--primary-rgb), 0.8);
            filter: brightness(110%);
        }
        
        /* For tabs that should be hidden initially */
        .level-content {
            display: none;
        }
        
        .level-content.active {
            display: block;
        }
        
        /* Empty cell styling */
        .empty-cell {
            background-color: #f5f5f5 !important;
            color: #999;
            font-style: italic;
        }
        
        /* File upload area */
        .file-upload {
            margin: 30px auto;
            max-width: 1000px;
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            border: 1px solid var(--border-color);
            text-align: center;
        }
        
        .file-upload-btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            margin: 10px;
        }
        
        /* Responsive design */
        @media screen and (max-width: 1100px) {
            .menu-toggle {
                display: block !important;
            }
            
            .nav-menu {
                display: none;
                width: 100%;
                flex-direction: column;
                position: absolute;
                top: 60px;
                left: 0;
                background-color: #333;
                z-index: 99;
                height: auto;
            }
            
            .nav-menu.active {
                display: flex !important;
            }
            
            .nav-menu li {
                width: 100%;
                height: auto;
            }
            
            .nav-menu li a {
                text-align: left;
                padding: 16px 20px;
                border-top: 1px solid #444;
                height: auto;
            }
            
            .selector-controls {
                flex-direction: column;
            }
            
            .papers-table th, .papers-table td {
                padding: 10px 8px;
                font-size: 0.9rem;
            }
            
            .download-link {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
        }
    </style>
    <title>A Level & BTEC Past Papers</title>
</head>
<body>
    <!-- Navigation from home page -->
    <div class="nav-container">
        <a href="index.html" class="logo">
            <img src="Logo.png" alt="Logo">
        </a>
        <button class="menu-toggle" aria-label="Toggle navigation menu">â˜°</button>
        <ul class="nav-menu">
            <li><a href="PR.html">GCSE Past Papers</a></li>
            <li><a href="APR.html">A Level Papers</a></li>
            <li><a href="SPBE.html">Geography Flashcards</a></li>
            <li><a href="BWT.html">Case Studies</a></li>
            <li><a href="test.html">Test Page</a></li>
        </ul>
    </div>
    
    <header class="page-header">
        <h1 id="main-title">A Level & BTEC Past Papers</h1>
        <h2 id="sub-title">Select an exam board and subject below</h2>
    </header>
    
    <div class="selector-controls">
        <div class="selector-group">
            <label class="selector-label" for="exam-board">Exam Board:</label>
            <select id="exam-board" class="custom-select">
                <option value="aqa">AQA</option>
                <option value="edexcel">Edexcel</option>
                <option value="ocr">OCR</option>
            </select>
        </div>
        
        <div class="selector-group">
            <label class="selector-label" for="subject">Subject:</label>
            <select id="subject" class="custom-select">
                <option value="default">Select a subject...</option>
                <!-- Options will be populated by JavaScript -->
            </select>
        </div>
    </div>
    
    <div id="content-area">
        <!-- Content will be loaded here by JavaScript -->
        <div class="papers-container" style="text-align: center; padding: 40px 20px;">
            <h2>Please select an exam board and subject</h2>
            <p>Use the dropdown menus above to view past papers for your chosen subject.</p>
        </div>
    </div>
    
    <!-- Admin file upload area (can be hidden in production) -->
    <div class="file-upload" id="admin-panel">
        <h2>Admin Panel: Upload CSV Data</h2>
        <p>Upload CSV files containing past paper links for each subject</p>
        <input type="file" id="csv-upload" accept=".csv" multiple>
        <button class="file-upload-btn" id="process-csv">Process CSV Files</button>
    </div>
    
    <script>
        // Subject data with their respective colors and levels
        const subjectData = {
            aqa: {
                "core-maths": {
                    name: "Core Maths",
                    primaryColor: "#1e7dba",
                    secondaryColor: "#e9f2f9",
                    levels: ["a-level"],
                    resources: [{name: "Formula Sheet", link: "https://filestore.aqa.org.uk/sample-papers-and-mark-schemes/2022/june/AQA-13502-DB-JUN22.PDF"}],
                    dataFile: "AQA_Core_Maths.csv"
                },
                "english-language": {
                    name: "English Language",
                    primaryColor: "#7030a0",
                    secondaryColor: "#f0e6f5",
                    levels: ["a-level", "as-level"],
                    resources: [{name: "Language Framework", link: "#"}],
                    dataFile: "AQA_English_Language.csv"
                },
                "geography": {
                    name: "Geography",
                    primaryColor: "#41723f",
                    secondaryColor: "#eaf2e9",
                    levels: ["a-level", "as-level"],
                    resources: [{name: "Case Studies", link: "#"}, {name: "Key Definitions", link: "#"}],
                    dataFile: "AQA_Geography.csv"
                },
                "mathematics": {
                    name: "Mathematics",
                    primaryColor: "#1e7dba",
                    secondaryColor: "#e9f2f9",
                    levels: ["a-level", "as-level"],
                    resources: [{name: "Formula Booklet", link: "#"}],
                    dataFile: "AQA_Mathematics.csv"
                }
            },
            edexcel: {
                "business-studies": {
                    name: "Business Studies",
                    primaryColor: "#b7312c",
                    secondaryColor: "#f9e9e8",
                    levels: ["a-level", "as-level"],
                    resources: [{name: "Key Terms", link: "#"}],
                    dataFile: "Edexcel_Business_Studies.csv"
                },
                "information-technology": {
                    name: "Information Technology",
                    primaryColor: "#f7941d",
                    secondaryColor: "#fef4e9",
                    levels: ["btec"],
                    resources: [{name: "Assessment Guidance", link: "#"}],
                    dataFile: "Edexcel_IT.csv"
                },
                "applied-science": {
                    name: "Applied Science",
                    primaryColor: "#00b050",
                    secondaryColor: "#e6f7ee",
                    levels: ["btec"],
                    resources: [{name: "Lab Safety Guide", link: "#"}],
                    dataFile: "Edexcel_Applied_Science.csv"
                }
            },
            ocr: {
                "physics-a": {
                    name: "Physics A",
                    primaryColor: "#4472c4",
                    secondaryColor: "#ebeff9",
                    levels: ["a-level", "as-level"],
                    resources: [{name: "Data Sheet", link: "#"}, {name: "Practical Skills Handbook", link: "#"}],
                    dataFile: "OCR_Physics_A.csv"
                }
            }
        };
        
        // Store parsed CSV data
        const paperData = {};
        
        // DOM elements
        const examBoardSelect = document.getElementById('exam-board');
        const subjectSelect = document.getElementById('subject');
        const contentArea = document.getElementById('content-area');
        const mainTitle = document.getElementById('main-title');
        const subTitle = document.getElementById('sub-title');
        const csvUpload = document.getElementById('csv-upload');
        const processCSVBtn = document.getElementById('process-csv');
        
        // Parse CSV function
        function parseCSV(csv) {
            const lines = csv.split('\n');
            const result = [];
            
            // Find the header row (typically contains column names)
            let headerRow = 0;
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].includes('Paper') && lines[i].includes('Mark Scheme')) {
                    headerRow = i;
                    break;
                }
            }
            
            // Find paper and mark scheme columns
            const headers = lines[headerRow].split(',');
            const columns = {};
            headers.forEach((header, index) => {
                if (header.includes('Paper') || header.includes('Mark Scheme')) {
                    columns[header.trim()] = index;
                }
            });
            
            // Find the data rows
            for (let i = headerRow + 2; i < lines.length; i++) {
                const line = lines[i].split(',');
                if (line.length <= 1 || !line[0].trim()) continue;
                
                const row = {
                    series: line[0],
                    links: {}
                };
                
                // Extract links for each column
                for (const [header, index] of Object.entries(columns)) {
                    if (line[index] && line[index].trim()) {
                        row.links[header.trim()] = line[index].trim();
                    }
                }
                
                result.push(row);
            }
            
            return result;
        }
        
        // Function to check if a string is a URL
        function isURL(str) {
            return str.startsWith('http://') || str.startsWith('https://');
        }
        
        // Process CSV file
        processCSVBtn.addEventListener('click', function() {
            const files = csvUpload.files;
            if (files.length === 0) {
                alert('Please select at least one CSV file to upload');
                return;
            }
            
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const fileName = file.name;
                    const content = e.target.result;
                    
                    // Extract subject info from filename
                    const subjectInfo = fileName.replace('.csv', '');
                    
                    // Parse CSV data
                    const data = parseCSV(content);
                    
                    // Store parsed data
                    paperData[subjectInfo] = data;
                    
                    console.log(`Processed: ${fileName}`);
                    console.log('Data:', data);
                };
                reader.readAsText(file);
            });
            
            alert(`Processed ${files.length} CSV files successfully.`);
        });
        
        // Update subject options based on selected exam board
        function updateSubjectOptions() {
            const board = examBoardSelect.value;
            
            // Clear current options
            subjectSelect.innerHTML = '<option value="default">Select a subject...</option>';
            
            // Add new options
            for (const [key, subject] of Object.entries(subjectData[board])) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = subject.name;
                subjectSelect.appendChild(option);
            }
        }
        
        // Update page content based on selections
        function updateContent() {
            const board = examBoardSelect.value;
            const subjectKey = subjectSelect.value;
            
            if (subjectKey === 'default') {
                contentArea.innerHTML = `
                    <div class="papers-container" style="text-align: center; padding: 40px 20px;">
                        <h2>Please select a subject</h2>
                        <p>Use the dropdown menu above to view past papers for your chosen subject.</p>
                    </div>
                `;
                return;
            }
            
            const subject = subjectData[board][subjectKey];
            
            // Update colors
            document.documentElement.style.setProperty('--primary-color', subject.primaryColor);
            document.documentElement.style.setProperty('--secondary-color', subject.secondaryColor);
            document.documentElement.style.setProperty('--primary-rgb', hexToRgb(subject.primaryColor));
            
            // Update page title
            mainTitle.textContent = `${getBoardName(board)} | ${subject.name}`;
            subTitle.textContent = 'Past Papers & Resources';
            
            // Get CSV data for this subject, if available
            const subjectCSVKey = `${getBoardName(board)}_${subject.name.replace(/\s+/g, '_')}`;
            const subjectCSVData = paperData[subjectCSVKey] || [];
            
            // Build the content
            let contentHTML = '';
            
            // Resources section
            contentHTML += `
                <section class="resources-section">
                    <h2 class="resources-header">Resources</h2>
                    <table class="resources-table">
            `;
            
            subject.resources.forEach(resource => {
                contentHTML += `
                    <tr>
                        <td width="30%"><strong>${resource.name}:</strong></td>
                        <td><a href="${resource.link}" class="download-link" target="_blank">${resource.name}</a></td>
                    </tr>
                `;
            });
            
            contentHTML += `
                    </table>
                </section>
            `;
            
            // Level tabs if needed
            if (subject.levels.length > 1) {
                contentHTML += `<div class="level-tabs">`;
                subject.levels.forEach((level, index) => {
                    const isActive = index === 0 ? 'active' : '';
                    contentHTML += `
                        <div class="level-tab ${isActive}" data-level="${level}" onclick="activateTab('${level}')">
                            ${formatLevelName(level)}
                        </div>
                    `;
                });
                contentHTML += `</div>`;
            }
            
            // Create tables for each level
            subject.levels.forEach((level, index) => {
                const isActive = index === 0 ? 'active' : '';
                
                contentHTML += `
                    <div id="${level}-content" class="level-content ${isActive}">
                        <main class="papers-container">
                            <table class="papers-table">
                                <thead>
                                    <tr>
                                        <th width="20%">Exam Series</th>
                `;
                
                // Headers based on level
                if (level === 'btec') {
                    contentHTML += `
                        <th width="40%">Assignment Brief</th>
                        <th width="40%">Sample Assessment</th>
                    `;
                } else {
                    contentHTML += `
                        <th width="20%">Paper 1<br>Question Paper</th>
                        <th width="20%">Paper 1<br>Mark Scheme</th>
                        <th width="20%">Paper 2<br>Question Paper</th>
                        <th width="20%">Paper 2<br>Mark Scheme</th>
                    `;
                }
                
                contentHTML += `
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                // Use exam series from CSV if available, otherwise use default
                const examSeriesData = subjectCSVData.length > 0 ? 
                    subjectCSVData : 
                    [
                        { series: "June 2023", links: {} },
                        { series: "June 2022", links: {} },
                        { series: "November 2021", links: {} },
                        { series: "June 2019", links: {} },
                        { series: "June 2018", links: {} },
                        { series: "June 2017", links: {} },
                        { series: "June 2016", links: {} },
                        { series: "Sample Set", links: {} }
                    ];
                
                // Add rows for each exam series
                examSeriesData.forEach(seriesData => {
                    contentHTML += `
                        <tr>
                            <td class="series-column">${seriesData.series}</td>
                    `;
                    
                    if (level === 'btec') {
                        const brief = seriesData.links['Assignment Brief'] || '#';
                        const assessment = seriesData.links['Sample Assessment'] || '#';
                        
                        contentHTML += `
                            <td>${isURL(brief) ? `<a href="${brief}" class="download-link" target="_blank">Download</a>` : `<span class="empty-cell">N/A</span>`}</td>
                            <td>${isURL(assessment) ? `<a href="${assessment}" class="download-link" target="_blank">Download</a>` : `<span class="empty-cell">N/A</span>`}</td>
                        `;
                    } else {
                        const paper1 = seriesData.links['Paper 1'] || seriesData.links['Paper'] || '#';
                        const paper1MS = seriesData.links['Paper 1 Mark Scheme'] || seriesData.links['Mark Scheme'] || '#';
                        const paper2 = seriesData.links['Paper 2'] || seriesData.links['Paper 2A - Statistical Techniques'] || '#';
                        const paper2MS = seriesData.links['Paper 2 Mark Scheme'] || seriesData.links['Mark Scheme.1'] || '#';
                        
                        contentHTML += `
                            <td>${isURL(paper1) ? `<a href="${paper1}" class="download-link" target="_blank">Download</a>` : `<span class="empty-cell">N/A</span>`}</td>
                            <td>${isURL(paper1MS) ? `<a href="${paper1MS}" class="download-link" target="_blank">Download</a>` : `<span class="empty-cell">N/A</span>`}</td>
                            <td>${isURL(paper2) ? `<a href="${paper2}" class="download-link" target="_blank">Download</a>` : `<span class="empty-cell">N/A</span>`}</td>
                            <td>${isURL(paper2MS) ? `<a href="${paper2MS}" class="download-link" target="_blank">Download</a>` : `<span class="empty-cell">N/A</span>`}</td>
                        `;
                    }
                    
                    contentHTML += `</tr>`;
                });
                
                contentHTML += `
                                </tbody>
                            </table>
                        </main>
                    </div>
                `;
            });
            
            contentArea.innerHTML = contentHTML;
        }
        
        // Helper function to format level names
        function formatLevelName(level) {
            switch (level) {
                case 'a-level': return 'A Level';
                case 'as-level': return 'AS Level';
                case 'btec': return 'BTEC';
                default: return level;
            }
        }
        
        // Helper function to get the board's full name
        function getBoardName(boardKey) {
            switch (boardKey) {
                case 'aqa': return 'AQA';
                case 'edexcel': return 'Edexcel';
                case 'ocr': return 'OCR';
                default: return boardKey;
            }
        }
        
        // Helper function to convert hex to rgb
        function hexToRgb(hex) {
            // Remove # if present
            hex = hex.replace('#', '');
            
            // Parse the hex values
            const r = parseInt(hex.substring(0, 2), 16);
            const g = parseInt(hex.substring(2, 4), 16);
            const b = parseInt(hex.substring(4, 6), 16);
            
            return `${r}, ${g}, ${b}`;
        }
        
        // Function to activate a tab
        window.activateTab = function(level) {
            // Update tab classes
            document.querySelectorAll('.level-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-level') === level) {
                    tab.classList.add('active');
                }
            });
            
            // Update content classes
            document.querySelectorAll('.level-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${level}-content`).classList.add('active');
        };
        
        // Function to load CSV data from a file path
        function loadCSVFromFile(filePath, callback) {
            fetch(filePath)
                .then(response => response.text())
                .then(data => {
                    const parsedData = parseCSV(data);
                    callback(parsedData);
                })
                .catch(error => {
                    console.error('Error loading CSV file:', error);
                    callback([]);
                });
        }
        
        // Event listeners
        examBoardSelect.addEventListener('change', () => {
            updateSubjectOptions();
            // Reset subject selection
            subjectSelect.value = 'default';
            updateContent();
        });
        
        subjectSelect.addEventListener('change', () => {
            const board = examBoardSelect.value;
            const subjectKey = subjectSelect.value;
            
            if (subjectKey !== 'default') {
                const subject = subjectData[board][subjectKey];
                const csvFileName = subject.dataFile;
                
                if (csvFileName) {
                    // Try to load the CSV file if it exists
                    const subjectCSVKey = `${getBoardName(board)}_${subject.name.replace(/\s+/g, '_')}`;
                    
                    // Only load if we haven't already loaded it
                    if (!paperData[subjectCSVKey]) {
                        loadCSVFromFile(csvFileName, (data) => {
                            paperData[subjectCSVKey] = data;
                            updateContent();
                        });
                    } else {
                        updateContent();
                    }
                } else {
                    updateContent();
                }
            } else {
                updateContent();
            }
        });
        
        // Initialize the page
        updateSubjectOptions();
        
// Navigation menu toggle functionality
document.addEventListener('DOMContentLoaded', function() {
    const menuToggle = document.querySelector('.menu-toggle');
    const navMenu = document.querySelector('.nav-menu');
    
    menuToggle.addEventListener('click', function() {
        navMenu.classList.toggle('active');
    });
    
    // Close the menu when clicking outside
    document.addEventListener('click', function(e) {
        if (!navMenu.contains(e.target) && !menuToggle.contains(e.target)) {
            navMenu.classList.remove('active');
        }
    });
    
    // Hide admin panel - we don't need file uploads
    document.getElementById('admin-panel').style.display = 'none';
    
    // Auto-load CSV data when subject changes
    subjectSelect.addEventListener('change', () => {
        const board = examBoardSelect.value;
        const subjectKey = subjectSelect.value;
        
        if (subjectKey !== 'default') {
            const subject = subjectData[board][subjectKey];
            // CSV filename is same as the subject key with .csv extension
            const csvFileName = `${subjectKey}.csv`;
            
            // Try to load the CSV file
            loadCSVFromFile(csvFileName, (data) => {
                const subjectCSVKey = `${getBoardName(board)}_${subject.name.replace(/\s+/g, '_')}`;
                paperData[subjectCSVKey] = data;
                updateContent();
            });
        } else {
            updateContent();
        }
    });
});

// Modify the parseCSV function to better handle various CSV formats
function parseCSV(csv) {
    const lines = csv.split('\n');
    const result = [];
    
    // Find the header row
    let headerRow = 0;
    for (let i = 0; i < Math.min(10, lines.length); i++) {
        if (lines[i].includes('Paper') || lines[i].includes('Mark Scheme') || 
            lines[i].includes('Question Paper') || lines[i].includes('Exam Series')) {
            headerRow = i;
            break;
        }
    }
    
    // Parse headers
    const headers = lines[headerRow].split(',').map(h => h.trim());
    const seriesIndex = headers.findIndex(h => 
        h.includes('Series') || h.includes('Date') || h === 'Exam Series' || h === '');
    
    // Find all paper and mark scheme columns
    const columns = {};
    headers.forEach((header, index) => {
        if (index !== seriesIndex && header) {
            columns[header] = index;
        }
    });
    
    // Parse data rows
    for (let i = headerRow + 1; i < lines.length; i++) {
        if (!lines[i].trim()) continue;
        
        const line = lines[i].split(',');
        if (line.length <= 1) continue;
        
        const row = {
            series: line[seriesIndex].trim(),
            links: {}
        };
        
        // Extract links for each column
        for (const [header, index] of Object.entries(columns)) {
            if (line[index] && line[index].trim()) {
                row.links[header] = line[index].trim();
            }
        }
        
        if (row.series) {
            result.push(row);
        }
    }
    
    return result;
}

// Update the updateContent function to properly display table cells
function updateContent() {
    const board = examBoardSelect.value;
    const subjectKey = subjectSelect.value;
    
    if (subjectKey === 'default') {
        contentArea.innerHTML = `
            <div class="papers-container" style="text-align: center; padding: 40px 20px;">
                <h2>Please select a subject</h2>
                <p>Use the dropdown menu above to view past papers for your chosen subject.</p>
            </div>
        `;
        return;
    }
    
    const subject = subjectData[board][subjectKey];
    
    // Update colors
    document.documentElement.style.setProperty('--primary-color', subject.primaryColor);
    document.documentElement.style.setProperty('--secondary-color', subject.secondaryColor);
    document.documentElement.style.setProperty('--primary-rgb', hexToRgb(subject.primaryColor));
    
    // Update page title
    mainTitle.textContent = `${getBoardName(board)} | ${subject.name}`;
    subTitle.textContent = 'Past Papers & Resources';
    
    // Get CSV data for this subject
    const subjectCSVKey = `${getBoardName(board)}_${subject.name.replace(/\s+/g, '_')}`;
    const subjectCSVData = paperData[subjectCSVKey] || [];
    
    // Build the content
    let contentHTML = '';
    
    // Resources section
    contentHTML += `
        <section class="resources-section">
            <h2 class="resources-header">Resources</h2>
            <table class="resources-table">
    `;
    
    subject.resources.forEach(resource => {
        contentHTML += `
            <tr>
                <td width="30%" style="text-align: left;"><strong>${resource.name}:</strong></td>
                <td style="text-align: left;"><a href="${resource.link}" class="download-link" target="_blank">${resource.name}</a></td>
            </tr>
        `;
    });
    
    contentHTML += `
            </table>
        </section>
    `;
    
    // Level tabs if needed
    if (subject.levels.length > 1) {
        contentHTML += `<div class="level-tabs">`;
        subject.levels.forEach((level, index) => {
            const isActive = index === 0 ? 'active' : '';
            contentHTML += `
                <div class="level-tab ${isActive}" data-level="${level}" onclick="activateTab('${level}')">
                    ${formatLevelName(level)}
                </div>
            `;
        });
        contentHTML += `</div>`;
    }
    
    // Create tables for each level
    subject.levels.forEach((level, index) => {
        const isActive = index === 0 ? 'active' : '';
        
        contentHTML += `
            <div id="${level}-content" class="level-content ${isActive}">
                <main class="papers-container">
                    <table class="papers-table">
                        <thead>
                            <tr>
                                <th width="20%" style="text-align: left;">Exam Series</th>
        `;
        
        // Get column headers from data if available, otherwise use defaults
        const columnHeaders = [];
        if (subjectCSVData.length > 0 && subjectCSVData[0].links) {
            // Use headers from the CSV data
            for (const header in subjectCSVData[0].links) {
                columnHeaders.push(header);
            }
        } else if (level === 'btec') {
            columnHeaders.push('Assignment Brief', 'Sample Assessment');
        } else {
            columnHeaders.push('Paper 1', 'Paper 1 Mark Scheme', 'Paper 2', 'Paper 2 Mark Scheme');
        }
        
        // Add column headers
        columnHeaders.forEach(header => {
            contentHTML += `<th style="text-align: center;">${header}</th>`;
        });
        
        contentHTML += `
                            </tr>
                        </thead>
                        <tbody>
        `;
        
        // Add rows for each exam series
        const examSeriesData = subjectCSVData.length > 0 ? 
            subjectCSVData : 
            [
                { series: "June 2023", links: {} },
                { series: "June 2022", links: {} },
                { series: "November 2021", links: {} },
                { series: "June 2019", links: {} }
            ];
        
        examSeriesData.forEach(seriesData => {
            contentHTML += `
                <tr>
                    <td class="series-column" style="text-align: left;">${seriesData.series}</td>
            `;
            
            // Add cells for each column
            columnHeaders.forEach(header => {
                const link = seriesData.links[header] || '#';
                contentHTML += `
                    <td style="text-align: center;">
                        ${isURL(link) ? 
                            `<a href="${link}" class="download-link" target="_blank">Download</a>` : 
                            `<span class="empty-cell">N/A</span>`}
                    </td>
                `;
            });
            
            contentHTML += `</tr>`;
        });
        
        contentHTML += `
                        </tbody>
                    </table>
                </main>
            </div>
        `;
    });
    
    contentArea.innerHTML = contentHTML;
}

// Fix the papers-table styles to ensure left alignment where needed
document.addEventListener('DOMContentLoaded', function() {
    const style = document.createElement('style');
    style.innerHTML = `
        .papers-table th:first-child, .papers-table td:first-child {
            text-align: left;
        }
        .resources-table td {
            text-align: left;
        }
    `;
    document.head.appendChild(style);
});
</script>
</body>
</html>